name: Update Website Stats

on:
  schedule:
    - cron: '*/5 * * * *'  # æ¯5åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:                     # ä»£ç æ¨é€æ—¶è§¦å‘
    paths:
      - 'data.json'

jobs:
  update-stats:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Update statistics (ç›´æ¥å†…åµŒPythonä»£ç )
      run: |
        # ç›´æ¥åœ¨YAMLä¸­å†™Pythoné€»è¾‘ï¼Œä¸éœ€è¦å¤–éƒ¨æ–‡ä»¶
        python << 'EOF'
import json
import os
from datetime import datetime
import random

print("å¼€å§‹æ›´æ–°ç½‘ç«™ç»Ÿè®¡æ•°æ®...")

# è¯»å–æˆ–åˆå§‹åŒ–æ•°æ®æ–‡ä»¶
try:
    with open('data.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    print(f"è¯»å–åˆ°ç°æœ‰æ•°æ®: è®¿é—®é‡={data.get('pageViews', 0)}, ç‚¹èµæ•°={data.get('likes', 0)}")
except Exception as e:
    print("æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨æˆ–è¯»å–å¤±è´¥ï¼Œåˆ›å»ºæ–°æ–‡ä»¶")
    data = {"pageViews": 0, "likes": 0, "lastUpdated": ""}

# æ›´æ–°æ•°æ®
data['pageViews'] = data.get('pageViews', 0) + 1

# éšæœºæ¨¡æ‹Ÿç‚¹èµï¼ˆ30%æ¦‚ç‡ï¼‰
if random.random() < 0.3:
    data['likes'] = data.get('likes', 0) + 1
    print("ğŸ‰ æ¨¡æ‹Ÿç”¨æˆ·ç‚¹èµï¼Œç‚¹èµæ•°+1")

data['lastUpdated'] = datetime.now().isoformat()

# ä¿å­˜æ•°æ®
with open('data.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=2, ensure_ascii=False)

print(f"âœ… æ›´æ–°å®Œæˆï¼è®¿é—®é‡: {data['pageViews']}, ç‚¹èµæ•°: {data['likes']}")
EOF

    - name: Commit and push changes
      run: |
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git add data.json
        git diff --cached --quiet || git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°: è®¿é—®é‡+1 [skip ci]"
        git push
