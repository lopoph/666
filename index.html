<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨设备计数</title>
    <style>
        body { max-width: 600px; margin: 50px auto; text-align: center; font-family: Arial, sans-serif; }
        .data-box { margin: 30px 0; font-size: 20px; }
        button { padding: 12px 30px; font-size: 18px; background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>访问&点赞计数（跨设备实时）</h1>
    <div class="data-box">
        <div>当前访问次数：<span id="visit">加载中...</span></div>
        <div>当前点赞次数：<span id="like">加载中...</span></div>
    </div>
    <button onclick="addLike()">点赞</button>

    <script>
        // 替换为你的信息
        const GIST_ID = "eab3ee8d8cd26c542f06ca09004b82d9";
        const GH_TOKEN = "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";
        const GIST_URL = `https://api.github.com/gists/${GIST_ID}`;

        // 页面加载=访问+加载计数
        window.onload = async () => {
            await updateCount("visit");
            await loadCount();
        };

        // 加载计数（跨设备实时）
        async function loadCount() {
            const res = await fetch(GIST_URL, { headers: { "Authorization": `token ${GH_TOKEN}` } });
            const data = await res.json();
            const count = JSON.parse(data.files["count.json"].content);
            document.getElementById("visit").textContent = count.visit;
            document.getElementById("like").textContent = count.like;
        }

        // 更新计数（访问/点赞）
        async function updateCount(type) {
            // 先获取当前计数
            const res = await fetch(GIST_URL, { headers: { "Authorization": `token ${GH_TOKEN}` } });
            const data = await res.json();
            const count = JSON.parse(data.files["count.json"].content);
            
            // 增加对应计数
            count[type]++;
            
            // 写回Gist
            await fetch(GIST_URL, {
                method: "PATCH",
                headers: { "Authorization": `token ${GH_TOKEN}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    files: { "count.json": { content: JSON.stringify(count) } }
                })
            });
        }

        // 点赞
        async function addLike() {
            await updateCount("like");
            await loadCount();
        }
    </script>
</body>
</html>
